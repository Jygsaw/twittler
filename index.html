<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="twittler.css" media="screen" />
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <div class="content"></div>
    <script>
      // initialize global variables
      var userFilter = undefined;

      // render tweets
      function renderTweets() {
        // clear tweets
        $content = $(".content");
        $content.html("");

        // select tweets to display
        var tweets = filterTweets(streams.home, userFilter);

        // display tweets
        for (var i = 0; i < tweets.length; i++) {
          buildTweetElem(tweets[i]).appendTo($content);
        }
      }

      // select tweets to display based on given user
      function filterTweets(tweets, user) {
        var result = [];
        for (var i = tweets.length - 1; i >= 0; i--) {
          if (user === tweets[i].user || user === undefined) result.push(tweets[i]);
        }
        return result;
      }

      // builds DOM elements for given tweet
      function buildTweetElem(tweet) {
        var $tweet = $("<div></div>");
        var user = tweet.user;
        var message = tweet.message;
        var time = tweet.created_at;

        // create tweet user link elem
        var $userLink = $('<a href="#">@' + user + '</a>');
        $userLink.on('click', function(event) {
          event.stopPropagation();
          event.preventDefault();
          userFilter = user;
          renderPage();
        });
        $tweet.append($userLink);

        // create tweet text elem
        var $textElem = $('<text>: ' + message + ' [' + time + ']</text>');
        $tweet.append($textElem);

        return $tweet;
      }

      // MAIN SCRIPT
      $(document).ready(function(){
        // display initial page
        renderTweets();

        // initiate render loop
        window.setInterval(function() {
          renderTweets();
        }, 2000);
      });
    </script>
  </body>
</html>
